#!/usr/bin/make -f
#export DH_VERBOSE=1

ARCH=$(shell dpkg-architecture -qDEB_HOST_ARCH)
ifeq ($(ARCH), amd64)
	URL=https://github.com/bq/bitbloq-offline/releases/download/v1.0.2/linux.zip
else
	URL=https://github.com/bq/bitbloq-offline/releases/download/v1.0.2/linux32.zip
endif



%:
	dh $@ 

override_dh_auto_build:
	if [ ! -d build ]; then \
		mkdir build ;\
		( cd build && wget $(URL) && unzip *.zip); \
	fi

	if [ -e build/linux32 ]; then \
		mv build/linux32 build/linux ;\
	fi


override_dh_clean:
	dh_clean
	rm -rf build


#override_dh_shlibdeps:
#	dh_shlibdeps --dpkg-shlibdeps-params=--ignore-missing-info


override_dh_shlibdeps:
	dh_shlibdeps -Xusr/share/bitbloq-offline/resources/app/app/res/web2board/linux/res/pp/packages/toolchain-atmelavr/avr/lib \
		     -Xusr/share/bitbloq-offline/resources/app/app/res/web2board/linux \
		     -Xusr/share/bitbloq-offline/libgcrypt.so.11 \
		     -Xusr/share/bitbloq-offline/libnode.so \
		     -Xusr/share/bitbloq-offline/Bitbloq

override_dh_strip:
	# do not strip, break executables
